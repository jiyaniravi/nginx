events {
   
}

http {

    include mime.types;

    server{
        listen 80;
        server_name 172.17.160.201;

        root /home/rjiyani/projects/demo;

        #--------------------------------------------------------------------------------------------------
        # Various paths/location configurations
        #--------------------------------------------------------------------------------------------------
        #prefix match
        location /greet {
            return 200 'Hello from nginx any location starting with /greet';
        }

        #exact match
        location = /greet {
            return 200 'Hello from nginx exact /greet location';
        }

        #regex match, it is case sensitive - use of pcre lib
        location ~ /greet[0-9] {
            return 200 'Hello from nginx regex /greet location';
        }

        #regex match, it is case insensitive - use of pcre lib
         location ~* /greet[0-9] {
             return 200 'Hello from nginx regex /greet location : Case insensetive';
         }

        #Preferential prefix modifier
        location ^~ /Greet2 {
            return 200 'Hello from nginx Preferential prefix modifier /Greet2 location';
        }


        #--------------------------------------------------------------------------------------------------
        # Inspect variable values and query parameters in URL
        #--------------------------------------------------------------------------------------------------
        location /inspect {
            return 200 "$host\n$uri\n$args\n$arg_name";
        }


        #--------------------------------------------------------------------------------------------------
        # Check static API Key
        #--------------------------------------------------------------------------------------------------
        location /validate_login {
            if ( $arg_apikey != 12345 ){
                return 401 'Unauthorised Call!';        
            }

            return 200 'Authorised Call!';
        }

        #--------------------------------------------------------------------------------------------------
        # Create custom variable, change value, use in response 
        #--------------------------------------------------------------------------------------------------
        set $is_weekend 'No';
        if ( $date_local ~ 'Saturday|Sunday' ){
            set $is_weekend 'Yes';
        }
        location /is_weekend {
            return 200 'Is weekend : $is_weekend';
        }

        #--------------------------------------------------------------------------------------------------
        # Redirect/return URL response to another path 
        #--------------------------------------------------------------------------------------------------
        location /logo {
            return 307 /thumb.png;
        }

        #--------------------------------------------------------------------------------------------------
        # Rewrite URL path
        #--------------------------------------------------------------------------------------------------
        # rewrite ^/user/\w+ /greet;
        rewrite ^/user/(\w+) /greet/$1 last;
        rewrite ^/greet/ravi /thumb.png;
        location = /greet/ravi {
            return 200 "Hello Ravi";
        }

        #--------------------------------------------------------------------------------------------------
        # try_files check for existance of file, if it exists irrespective of URL it will be served
        #--------------------------------------------------------------------------------------------------
        #try_files /thumb.png /greet;
        try_files /cat.png /greet;

        #--------------------------------------------------------------------------------------------------
        # Create custom access log file based on URL
        #--------------------------------------------------------------------------------------------------
        location /secure {
            access_log /var/log/nginx/secure.access.log;
            access_log /var/log/nginx/access.log;   # To get access log entries in more than one file
            return 200 "This location is secure!";
        }
    }
}
